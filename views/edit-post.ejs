<%- include('partials/head', { title }) %>
<%- include('partials/navbar') %>

<main class="admin-form-container">
  <h1>Edit Post âœï¸</h1>

  <form action="/admin/edit/<%= post._id %>" method="POST" enctype="multipart/form-data" class="post-form">
    <div class="form-group">
      <label for="title">ğŸ“° Title</label>
      <input type="text" name="title" id="title" required value="<%= post.title %>">
    </div>

    <div class="form-group">
      <label for="category">ğŸ“‚ Category</label>
      <input type="text" name="category" id="category" required value="<%= post.category %>">
    </div>

    <div class="form-group">
      <label for="videoUrl">ğŸ¬ YouTube Video URL</label>
      <input type="url" name="videoUrl" id="videoUrl" value="<%= post.videoUrl %>">
    </div>

    <div class="form-group">
      <label>Current Image:</label>
      <% if (post.media) { %>
        <img src="<%= post.media %>" alt="Current image" style="max-width: 300px; border-radius: 6px; margin-bottom: 0.5rem;">
      <% } else { %>
        <p>No image uploaded</p>
      <% } %>
    </div>

    <div class="form-group">
      <label for="media">ğŸ–¼ Replace Image</label>
      <input type="file" name="media" id="media" accept="image/*">
    </div>

    <div class="form-group">
      <label for="content">ğŸ“ Post Content (Markdown)</label>
      <textarea name="content" id="content" rows="10" required><%= post.content %></textarea>
    </div>

    <button type="submit" class="submit-btn">ğŸ’¾ Update Post</button>
  </form>

  <!-- ğŸ” Live Markdown Preview -->
  <div class="preview-box">
    <h3>ğŸ” Live Preview</h3>
    <div id="livePreview" class="post-preview"></div>
  </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.5/dist/purify.min.js"></script>
<script>
  const contentInput = document.getElementById('content');
  const preview = document.getElementById('livePreview');

  contentInput?.addEventListener('input', () => {
    const raw = contentInput.value;
    preview.innerHTML = DOMPurify.sanitize(marked.parse(raw));
  });

  // Trigger preview on page load
  window.addEventListener('DOMContentLoaded', () => {
    if (contentInput.value) {
      preview.innerHTML = DOMPurify.sanitize(marked.parse(contentInput.value));
    }
  });
</script>

<%- include('partials/footer') %>
