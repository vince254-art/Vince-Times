<%- include('partials/head', { title: 'Admin Dashboard' }) %>
<%- include('partials/navbar') %>

<nav class="admin-nav">
  <a href="/admin/comments" title="View and delete user comments">Moderate CommentsğŸš®</a>
</nav>

<main data-aos="fade-up" class="container fade-in space-y-10">
  <h1 class="page-title">
    Admin Dashboard ğŸ˜
  </h1>

  <!-- â• Create New Post -->
  <form action="/admin/new" method="POST" enctype="multipart/form-data" class="card space-y-4">
    <h2 class="section-title">New PostğŸ†•</h2>

    <div>
      <label class="form-label" for="title">Post Title</label>
      <input type="text" id="title" name="title" placeholder="Post Title" required class="form-input" />
    </div>

    <div>
      <label class="form-label" for="author">Author</label>
      <input type="text" id="author" name="author" placeholder="Author name" class="form-input" />
    </div>

    <div>
      <label class="form-label">Content</label>
      <div id="editor" class="editor"></div>
      <textarea name="content" id="content" hidden></textarea>
    </div>

    <div>
      <label class="form-label" for="category">Category</label>
      <select name="category" id="category" required class="form-input">
        <option value="">-- Select Category --</option>
        <option value="News">News</option>
        <option value="Technology">Technology</option>
        <option value="Lifestyle">Lifestyle</option>
        <option value="Sports">Sports</option>
        <option value="Opinion">Opinion</option>
        <option value="Politics">Politics</option>
        <option value="Entertainment">Entertainment</option>
        <option value="Business">Business</option>
      </select>
    </div>

    <div>
      <label class="form-label" for="videoUrl">YouTube video URL (optional)</label>
      <input type="text" name="videoUrl" id="videoUrl" placeholder="YouTube video URL" class="form-input" />
    </div>

    <div>
      <label class="form-label" for="media">Media</label>
      <input type="file" name="media" id="media" class="form-input" />
    </div>

    <button type="submit" class="button">Publish PostğŸ–¨ï¸</button>
  </form>

  <!-- ğŸ“° List of Posts -->
  <section class="space-y-6">
    <h2 class="section-title">Post PageğŸ“¥</h2>
    <% posts.forEach(post => { %>
      <div class="bg-white dark:bg-gray-900 rounded-lg shadow border border-gray-200 dark:border-gray-700 p-5">
        <div class="flex flex-col gap-1 sm:flex-row sm:items-center sm:justify-between">
          <div>
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white"><%= post.title %></h3>
            <p class="text-sm text-gray-600 dark:text-gray-400">
              <span class="inline-block bg-gray-200 text-gray-800 px-2 py-0.5 rounded text-xs font-medium dark:bg-gray-700 dark:text-gray-100">
                <%= post.category || 'Uncategorized' %>
              </span>
              &middot;
              <%= new Date(post.date || post.createdAt || post.id).toLocaleDateString() %>
            </p>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-wrap gap-3 mt-4 ml-auto sm:ml-0 sm:justify-end">
          <a href="/post/<%= post.id %>" class="px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 transition">
            View
          </a>
          <a href="/admin/edit/<%= post.id %>" class="px-3 py-1 text-sm bg-yellow-500 text-white rounded hover:bg-yellow-600 transition">
            Edit
          </a>
          <form action="/admin/delete/<%= post.id %>" method="POST" onsubmit="return confirm('Are you sure?')" class="inline">
            <button type="submit" class="px-3 py-1 text-sm bg-red-600 text-white rounded hover:bg-red-700 transition">
              Delete
            </button>
          </form>
        </div>
      </div>
    <% }) %>
  </section>
</main>

<%- include('partials/footer') %>

<!-- Quill Scripts -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script>
  const quill = new Quill('#editor', {
    theme: 'snow',
    placeholder: 'Write something amazing...',
    modules: {
      toolbar: [
        [{ header: [1, 2, false] }],
        ['bold', 'italic', 'underline'],
        ['link', 'image'],
        [{ list: 'ordered' }, { list: 'bullet' }]
      ]
    }
  });
 
  document.querySelector('form').addEventListener('submit', function () {
    document.getElementById('content').value = quill.root.innerHTML;
  });
</script>